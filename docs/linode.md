# Linode Instructions/Notes

```
$ ssh root@<ip_address>
@remote # sudo apt update
@remote # sudo apt upgrade
@remote # echo "name-of-hostname" > /etc/hostname
@remote # hostname -F /etc/hostname
@remote # vi /etc/hosts
>>  add <ip_address> <uri> <hostname> to this file
@remote # dpkg-reconfigure tzdata
@remote # adduser <username>
@remote # adduser <username> sudo  # adds the user to the `sudo` group
@remote # exit
$ ssh <username>@<ip_address>
@remote $ mkdir -p ~/.ssh && sudo chmod 700 ~/.ssh
@remote $ exit
$ scp ~/.ssh/id_rsa.pub <username>@<ip_address>:~/.ssh/authorized_keys
$ ssh <username>@<ip_address>  # it should NOT prompt for a password
@remote $ vi /etc/ssh/sshd_config
>>  PermitRootLogin no
$ sudo service ssh restart

```

### Deployment
1. Run `deploy.sh`, passing the SCP destination using <user>@<ipaddress>
1. Stop any current `gunicorn` processes. (No need to kill `nginx`)
```
$ pkill gunicorn
```
1. Destroy the current virtualenv.
```
$ cd chrisdoescoding
$ pipenv --rm
```
1. Connect to the server: `$ ssh <ipaddress>`
1. Check the `~/mounting_point` directory for the SCP'd .zip file.
1. ~/chrisdoescoding with the contents of the zip file
1. Make sure the hardcoded files are set correctly
    * `~/chrisdoescoding/database` - contains name of database (see the one in the old directory)
    * `~/chrisdoescoding/secret` - autogenerated by deploy.sh
    * `~/chrisdoescoding/static` - check that this directory exists
    * `/etc/nginx/nginx.conf` - this file should carry over from previous deployments, i.e., you shouldn't have to touch it normally.
1. Build the environment and activate it.
```
$ pipenv install
$ pipenv shell
```
1. Start gunicorn
```
$ source start_prod
```
1. Double check the app is running.  Also check that nginx is listening see notes below.


### Other Notes:
```
>> Change a Password
# passwd <user>    # (as root) changes password for user
# passwd           # (as root) changes password for current user

>> Transfer a File
@localcomputer $ scp <file_to_transfer> <username>@<ip_address>:</path/to/destination>

>> See every process that is listening on a port
@remote $ sudo netstat -tulpn

>> View Current IP Tables Rules
$ sudo iptables -L -nv

>> Setup IP Tables
>> Copy the iptables rules to /tmp/v4
$ sudo iptables-restore < /tmp/v4
```
